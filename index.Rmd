---
title: "Computational Musicology Portfolio"
author: "Nina Verheijen"
date: "February 2021"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: flatly
---




```{r echo = FALSE, message=FALSE}
library(tidyverse)
library(dplyr)
library(spotifyr)
library(ggplot2)
library(plotly)
library(compmus)
```

```{r echo = FALSE}
all_data_rammstein <- get_playlist_audio_features("","4ubZwxPRbLmmaxwsrcoksY")

rammstein_paris <- get_playlist_audio_features("","4td6SJ4cvyFWgJn9I9EtnT")
rammstein_berlin <- get_playlist_audio_features("","1YWLnvtP4lgROQWB7HqZxT")

  

rammstein <- all_data_rammstein%>%
  select(c(36, 50, 6:16)) %>%
  mutate(
    track.album.release_date = lubridate::year(track.album.release_date)
  )
  
rammstein_live <- bind_rows(
  rammstein_paris %>% mutate(category = "live at paris"),
  rammstein_berlin %>% mutate(category = "live at berlin") 
  )%>%
  select(c(36, "category", 50, 6:16)) %>% 
  mutate(track.name = str_sub(track.name, 1,-8))

rammstein_not_live <- get_playlist_audio_features("","0A0m04BWQCIozwguPMaRzE") %>%
  select(c(36, 50, 6:16))

rammstein_not_live[29, "track.name"] = "Wilder Wein"

live_not_live <- bind_rows(
  rammstein_live,
  rammstein_not_live %>% mutate(category = "studio")
)

live_not_live <- live_not_live %>% mutate(
  track.name = tolower(track.name)
)

rammstein_sum <- rammstein%>%
  group_by(track.album.release_date)%>%
  summarise(
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_liveness = mean(liveness),
    mean_energy = mean(energy),
    mean_danceability = mean(danceability),
    mean_tempo = mean(tempo),
    mean_instrumentalness = mean(instrumentalness),
    mean_key = mean(key),
    mean_valence = mean(valence)
  )



```

### Why is *Diamant* so different from their other songs?

***

As mentioned before, *diamant* is a very atipical song from Rammstein since it sound much more like a full on ballad than a heavy metal song. To see how this song differs from a more typical Rammstein song like *Du hast* or *Links 2 3 4 *, the chroma-based and timbre-based self-similarity matrices for these songs are shown. What stands out is that *Du hast* and *Links 2 3 4* have a much more clear structure and when listening to the songs the patterns are very recognizable. *Diamant* on the other hand has a much more complex structure and when listening to the song it is hard to recognize the patterns from the matrix.


#### Diamant

```{r}
diamant <-
  get_tidy_audio_analysis("1UZs9dauJnxrqYxMIzxnwC") %>%
  compmus_align(bars, segments) %>%
  select(bars) %>%
  unnest(bars) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "acentre", norm = "manhattan"
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  )
bind_rows(
  diamant %>%
    compmus_self_similarity(pitches, "aitchison") %>%
    mutate(d = d / max(d), type = "Chroma"),
  diamant %>%
    compmus_self_similarity(timbre, "euclidean") %>%
    mutate(d = d / max(d), type = "Timbre")
) %>%
  mutate() %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")
```




#### Du hast

```{r echo = FALSE}
du_hast <-
  get_tidy_audio_analysis("5awDvzxWfd53SSrsRZ8pXO") %>%
  compmus_align(bars, segments) %>%
  select(bars) %>%
  unnest(bars) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "acentre", norm = "manhattan"
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  )
bind_rows(
  du_hast %>%
    compmus_self_similarity(pitches, "aitchison") %>%
    mutate(d = d / max(d), type = "Chroma"),
  du_hast %>%
    compmus_self_similarity(timbre, "euclidean") %>%
    mutate(d = d / max(d), type = "Timbre")
) %>%
  mutate() %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")
```

#### Link 2 3 4

```{r echo = FALSE}
links <-
  get_tidy_audio_analysis("52XYwQKlXp7scE7KrBBCID") %>%
  compmus_align(bars, segments) %>%
  select(bars) %>%
  unnest(bars) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "acentre", norm = "manhattan"
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  )
bind_rows(
  links %>%
    compmus_self_similarity(pitches, "aitchison") %>%
    mutate(d = d / max(d), type = "Chroma"),
  links %>%
    compmus_self_similarity(timbre, "euclidean") %>%
    mutate(d = d / max(d), type = "Timbre")
) %>%
  mutate() %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")
```


### Introduction

Starting in Berlin in 1994, Rammstein has been around for almost 30 years. With their first album *Herzeleid* released in September 1995, and their lates album *Rammstein* in May 2019, a lot has changed in the music industry since they first started. This raises the question whether their music has changed as well, and if so, how?

To answer this question, a corpus is used which consists of  the seven studio albums from Rammstein (77 tracks);

* *Herzeleid* (1995)
* *Sehnsucht* (1997)
* *Mutter* (2001)
* *Reise, Reise* (2004)
* *Rosenrot* (2005)
* *Liebe ist für alle da* (2009)
* *Rammstein* (2019)

In addition to this two live albums were also included (27 tracks);

* *Live aus Berlin* (1999)
* *Rammstein: Paris* (2017)

The studio albums were included to see if their music changed over time and if so how? What changed? What did not change through all those years? Are there similarities between albums?
The studio albums are added because it might also be interesting to look at differneces between live and studio albums.

The comparison points in this corpus are between the different studio albums, between the live albums and their corresponding studio tracks and between the live albums.

The corpus is quite representative as there are plenty of albums, and thus tracks, to compare. However, when looking at changes in albums over time, it has to be noted that 6 of the 7 studio albums were released in a 14 year time period (1995-2009), and in the last 12 years only one album has been released.

A few tracks that are atypical are *Diamant* (*Rammstein*, 2019), *Roter Sand* (*Liebe ist für alle da*, 2009), *Los* (*Reise, Reise*, 2004) and *Ein Lied* (*Rosenrot*, 2005). *Diamant* and *Roter Sand* have sound a lot more like ballads than the industrial metal we're used from Rammstein. *Los* and *Ein Lied* both have a more slow, easy going tempo and have less distortion than other songs in the corpus.




### What changed between the first and last album from Rammstein?


```{r echo = FALSE}
rammstein_2019 <- rammstein %>%
  filter(track.album.release_date == "2019")

rammstein_1995 <- rammstein %>%
  filter(track.album.release_date == "1995")

rammstein_first_last <- bind_rows(rammstein_1995, rammstein_2019)

rammstein_f_l_val <- ggplot(rammstein_first_last, aes(valence, danceability, color=factor(track.album.release_date), size=instrumentalness, label=track.name))+
  geom_point() +
  theme(legend.title = element_blank())

ggplotly(rammstein_f_l_val)%>%
  layout(legend = list(
      orientation = "v",
      x = "auto",
      font = list(
        family = "sans-serif",
        size = 15,
        color = "#000"),
      bgcolor = "#E2E2E2",
      bordercolor = "#FFFFFF",
      borderwidth = 2
    )
  ) %>%
  layout(legend=list(title=list(text=' Instrumentalness')))
```



***

When comparing the first and last album, the first one released in 1995 and the last one released in 2019, a few things have changed when looking at spotify features.


The features with the most change are danceability, valence and instrumentalness. The danceability, valence and instrumentalness are all lower in the last album than in the first album. 

### Rammstein's albums over time.

```{r echo=FALSE}
rammstein_dance_val <- ggplot(rammstein, aes(track.album.release_date, danceability, size=valence, color=instrumentalness, label=track.name)) +
  geom_point(alpha = 0.5)
 

rammstein_dance_val
```

***

To see if this was also the case when looking at all albums, the valence, danceability and instrumentalness were plotted for each album. It is clear that the danceability decreases over time, and with that the valence and instrumentalness as well.

The last album has the most variation in danceablity and valence. However, the instrumentalness stays quit the same for most tracks in the last album.





### Comparing live tracks to studio tracks.
```{r}
#live_not_live[["track.name"]]

```


```{r echo=FALSE}

rammstein_live_not_live <- ggplot(live_not_live, aes(valence, danceability, size=instrumentalness, color=category, label=track.name)) +
  geom_point(alpha=0.6) + 
  geom_path(aes(group=track.name), size = 0.05, color="black")+
  theme(legend.title = element_blank())



ggplotly(rammstein_live_not_live)%>%
  layout(legend = list(
      orientation = "v",
      x = "auto",
      itemizing = "trace",
      font = list(
        family = "sans-serif",
        size = 15,
        color = "#000"),
      bgcolor = "#E2E2E2",
      bordercolor = "#FFFFFF",
      borderwidth = 2
    )
  ) %>%
  layout(legend=list(title=list(text=' Instrumentalness')))
```

*** 
When comparing the live tracks, both from Berlin (1999) and from Paris (2017), to the studio tracks it is clear that the studio tracks have a higher valence and more danceability.

Different versions of the tracks are connected with lines. Which show that there is definitely some difference between the two live albums and between the live and studio tracks.



### Comparing two live versions of *Du hast*, one of the most iconic songs of Rammstein.

```{r}
Du_hast_berlin <-
  get_tidy_audio_analysis("7c6jrUp0VsgLXhlzP4QZSy") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)



Du_hast_paris <-
  get_tidy_audio_analysis("0qrwXiw0o8aoXHbaqSAAzz") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)


compmus_long_distance(
  Du_hast_berlin %>% mutate(pitches = map(pitches, compmus_normalise, "euclidean")),
  Du_hast_paris %>% mutate(pitches = map(pitches, compmus_normalise, "euclidean")),
  feature = pitches,
  method = "angular"
) %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Du hast live Berlin (1999)", y = "Du hast live Paris (2017)") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
```

***
When comparing a track that was played live in 1999 and in 2017 a small diagonal line can be seen in the middle, which indicates that the tracks are indeed somewhat similar.
